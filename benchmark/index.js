import H from"cli-table3";var g=class{static randomInt(e){let r=[];for(let o=0;o<e;o++)r.push(Math.floor(Math.random()*9007199254740992));return r}static descendingInt(e){let r=[];for(let o=0;o<e;o++)r.push(e-o);return r}static ascendingInt(e){let r=[];for(let o=0;o<e;o++)r.push(o);return r}static ascending3RandomExchangesInt(e){let r=[];for(let o=0;o<e;o++)r.push(o);for(let o=0;o<1;o++){let s=Math.floor(Math.random()*e),c=Math.floor(Math.random()*e),n=r[s];r[s]=r[c],r[c]=n}return r}static ascending10RandomEndInt(e){let r=[];for(let s=0;s<e;s++)r.push(s);let o=Math.max(0,e-10);for(let s=o;s<e;s++)r[s]=Math.floor(Math.random()*e);return r}static allEqualInt(e){let r=[];for(let o=0;o<e;o++)r.push(42);return r}static manyDuplicateInt(e){let r=[];for(let o=0;o<e;o++)r.push(Math.floor(Math.random()*(e/2*(Math.log(e)/Math.LN10))));return r}static someDuplicateInt(e){let r=[];for(let o=0;o<e;o++)r.push(Math.floor(Math.random()*e));return r}};var M=new Float32Array([1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9]),_=class{array=null;compare=null;length=0;minGallop=7;runLength=null;runStart=null;stackLength=0;stackSize=0;tmpStorageLength=256;constructor(e,r){this.array=e,this.compare=r,this.length=e.length,this.length<2*256&&(this.tmpStorageLength=this.length>>>1),this.tmp=new Array(this.tmpStorageLength),this.stackLength=this.length<120?5:this.length<1542?10:this.length<119151?19:40,this.runStart=new Array(this.stackLength),this.runLength=new Array(this.stackLength)}forceMergeRuns(){for(;this.stackSize>1;){let e=this.stackSize-2;e>0&&this.runLength[e-1]<this.runLength[e+1]&&e--,this.mergeAt(e)}}mergeAt(e){let r=this.compare,o=this.array,s=this.runStart[e],c=this.runLength[e],n=this.runStart[e+1],u=this.runLength[e+1];this.runLength[e]=c+u,e===this.stackSize-3&&(this.runStart[e+1]=this.runStart[e+2],this.runLength[e+1]=this.runLength[e+2]),this.stackSize--;let t=R(o[n],o,s,c,0,r);s+=t,c-=t,c!==0&&(u=T(o[s+c-1],o,n,u,u-1,r),u!==0&&(c<=u?this.mergeLow(s,c,n,u):this.mergeHigh(s,c,n,u)))}mergeHigh(e,r,o,s){let c=this.compare,n=this.array,u=this.tmp,t=0;for(t=0;t<s;t++)u[t]=n[o+t];let f=e+r-1,a=s-1,m=o+s-1,l=0,d=0;if(n[m--]=n[f--],--r===0){for(l=m-(s-1),t=0;t<s;t++)n[l+t]=u[t];return}if(s===1){for(m-=r,f-=r,d=m+1,l=f+1,t=r-1;t>=0;t--)n[d+t]=n[l+t];n[m]=u[a];return}let p=this.minGallop;for(;;){let h=0,b=0,L=!1;do if(c(u[a],n[f])<0){if(n[m--]=n[f--],h++,b=0,--r===0){L=!0;break}}else if(n[m--]=u[a--],b++,h=0,--s===1){L=!0;break}while((h|b)<p);if(L)break;do{if(h=r-R(u[a],n,e,r,r-1,c),h!==0){for(m-=h,f-=h,r-=h,d=m+1,l=f+1,t=h-1;t>=0;t--)n[d+t]=n[l+t];if(r===0){L=!0;break}}if(n[m--]=u[a--],--s===1){L=!0;break}if(b=s-T(n[f],u,0,s,s-1,c),b!==0){for(m-=b,a-=b,s-=b,d=m+1,l=a+1,t=0;t<b;t++)n[d+t]=u[l+t];if(s<=1){L=!0;break}}if(n[m--]=n[f--],--r===0){L=!0;break}p--}while(h>=7||b>=7);if(L)break;p<0&&(p=0),p+=2}if(this.minGallop=p,p<1&&(this.minGallop=1),s===1){for(m-=r,f-=r,d=m+1,l=f+1,t=r-1;t>=0;t--)n[d+t]=n[l+t];n[m]=u[a]}else{if(s===0)throw new Error("mergeHigh preconditions were not respected");for(l=m-(s-1),t=0;t<s;t++)n[l+t]=u[t]}}mergeLow(e,r,o,s){let c=this.compare,n=this.array,u=this.tmp,t=0;for(t=0;t<r;t++)u[t]=n[e+t];let f=0,a=o,m=e;if(n[m++]=n[a++],--s===0){for(t=0;t<r;t++)n[m+t]=u[f+t];return}if(r===1){for(t=0;t<s;t++)n[m+t]=n[a+t];n[m+s]=u[f];return}let l=this.minGallop;for(;;){let d=0,p=0,h=!1;do if(c(n[a],u[f])<0){if(n[m++]=n[a++],p++,d=0,--s===0){h=!0;break}}else if(n[m++]=u[f++],d++,p=0,--r===1){h=!0;break}while((d|p)<l);if(h)break;do{if(d=R(n[a],u,f,r,0,c),d!==0){for(t=0;t<d;t++)n[m+t]=u[f+t];if(m+=d,f+=d,r-=d,r<=1){h=!0;break}}if(n[m++]=n[a++],--s===0){h=!0;break}if(p=T(u[f],n,a,s,0,c),p!==0){for(t=0;t<p;t++)n[m+t]=n[a+t];if(m+=p,a+=p,s-=p,s===0){h=!0;break}}if(n[m++]=u[f++],--r===1){h=!0;break}l--}while(d>=7||p>=7);if(h)break;l<0&&(l=0),l+=2}if(this.minGallop=l,l<1&&(this.minGallop=1),r===1){for(t=0;t<s;t++)n[m+t]=n[a+t];n[m+s]=u[f]}else{if(r===0)throw new Error("mergeLow preconditions were not respected");for(t=0;t<r;t++)n[m+t]=u[f+t]}}mergeRuns(){for(;this.stackSize>1;){let e=this.stackSize-2;if(e>=1&&this.runLength[e-1]<=this.runLength[e]+this.runLength[e+1]||e>=2&&this.runLength[e-2]<=this.runLength[e]+this.runLength[e-1])this.runLength[e-1]<this.runLength[e+1]&&e--;else if(this.runLength[e]>this.runLength[e+1])break;this.mergeAt(e)}}pushRun(e,r){this.runStart[this.stackSize]=e,this.runLength[this.stackSize]=r,this.stackSize+=1}};function w(i,e,r,o){if(!Array.isArray(i))throw new TypeError("Can only sort arrays");e?typeof e!="function"&&(o=r,r=e,e=S):e=S,r||(r=0),o||(o=i.length);let s=o-r;if(s<2)return;let c=0;if(s<32){c=D(i,r,o,e),G(i,r,o,r+c,e);return}let n=new _(i,e),u=z(s);do{if(c=D(i,r,o,e),c<u){let t=s;t>u&&(t=u),G(i,r,r+t,r+c,e),c=t}n.pushRun(r,c),n.mergeRuns(),s-=c,r+=c}while(s!==0);n.forceMergeRuns()}function S(i,e){if(i===e)return 0;if(~~i===i&&~~e===e){if(i===0||e===0)return i<e?-1:1;if(i<0||e<0){if(e>=0)return-1;if(i>=0)return 1;i=-i,e=-e}let s=N(i),c=N(e),n=0;return s<c?(i*=M[c-s-1],e/=10,n=-1):s>c&&(e*=M[s-c-1],i/=10,n=1),i===e?n:i<e?-1:1}let r=String(i),o=String(e);return r===o?0:r<o?-1:1}function G(i,e,r,o,s){for(o===e&&o++;o<r;o++){let c=i[o],n=e,u=o;for(;n<u;){let f=n+u>>>1;s(c,i[f])<0?u=f:n=f+1}let t=o-n;switch(t){case 3:i[n+3]=i[n+2];case 2:i[n+2]=i[n+1];case 1:i[n+1]=i[n];break;default:for(;t>0;)i[n+t]=i[n+t-1],t--}i[n]=c}}function T(i,e,r,o,s,c){let n=0,u=0,t=1;if(c(i,e[r+s])>0){for(u=o-s;t<u&&c(i,e[r+s+t])>0;)n=t,t=(t<<1)+1,t<=0&&(t=u);t>u&&(t=u),n+=s,t+=s}else{for(u=s+1;t<u&&c(i,e[r+s-t])<=0;)n=t,t=(t<<1)+1,t<=0&&(t=u);t>u&&(t=u);let f=n;n=s-t,t=s-f}for(n++;n<t;){let f=n+(t-n>>>1);c(i,e[r+f])>0?n=f+1:t=f}return t}function R(i,e,r,o,s,c){let n=0,u=0,t=1;if(c(i,e[r+s])<0){for(u=s+1;t<u&&c(i,e[r+s-t])<0;)n=t,t=(t<<1)+1,t<=0&&(t=u);t>u&&(t=u);let f=n;n=s-t,t=s-f}else{for(u=o-s;t<u&&c(i,e[r+s+t])>=0;)n=t,t=(t<<1)+1,t<=0&&(t=u);t>u&&(t=u),n+=s,t+=s}for(n++;n<t;){let f=n+(t-n>>>1);c(i,e[r+f])<0?t=f:n=f+1}return t}function N(i){return i<1e5?i<100?i<10?0:1:i<1e4?i<1e3?2:3:4:i<1e7?i<1e6?5:6:i<1e9?i<1e8?7:8:9}function D(i,e,r,o){let s=e+1;if(s===r)return 1;if(o(i[s++],i[e])<0){for(;s<r&&o(i[s],i[s-1])<0;)s++;P(i,e,s)}else for(;s<r&&o(i[s],i[s-1])>=0;)s++;return s-e}function z(i){let e=0;for(;i>=32;)e|=i&1,i>>=1;return i+e}function P(i,e,r){for(r--;e<r;){let o=i[e];i[e++]=i[r],i[r--]=o}}import $ from"timsort";var k=(i,e)=>i-e,v=[10,100,1e3,1e4],x=i=>Math.floor(12e6/(i*(Math.log(i)/Math.LN10))),I=class{defaultResults;timsortResults;oldTimsortResults;table;constructor(){this.defaultResults={},this.timsortResults={},this.oldTimsortResults={},this.table=new H({head:["ArrayType","Length","Time default","Time old","Time new","Speedup default","Speedup old"],colWidths:[30,20,10,15,20],style:{head:["cyan"]}})}runBenchmark(){let e=[{name:"randomInt",fn:g.randomInt},{name:"descendingInt",fn:g.descendingInt},{name:"ascendingInt",fn:g.ascendingInt},{name:"ascending3RandomExchangesInt",fn:g.ascending3RandomExchangesInt},{name:"ascending10RandomEndInt",fn:g.ascending10RandomEndInt},{name:"allEqualInt",fn:g.allEqualInt},{name:"manyDuplicateInt",fn:g.manyDuplicateInt},{name:"someDuplicateInt",fn:g.someDuplicateInt}];if(e.length===0){console.log("No generator methods available to process.");return}for(let{name:r,fn:o}of e)for(let s of v){console.log(`Benchmarking ${r} with length ${s}`);try{let{defaultTime:c,timsortTime:n,oldTimsortTime:u}=this.benchmarkGenerator(o,s);this.table.push([r,s.toString(),Math.floor(c).toString(),Math.floor(u).toString(),Math.floor(n).toString(),n!==0?(c/n).toFixed(2):"N/A",n!==0?(u/n).toFixed(2):"N/A"])}catch(c){console.error(`Error benchmarking ${r} with length ${s}:`,c)}}console.log(this.table.toString())}benchmarkGenerator(e,r){let o=0,s=0,c=0,n=x(r);console.log(`Running ${n} repetitions for length ${r}`);for(let u=0;u<n;u++){let t=e(r),f=t.slice(),a=t.slice();if(!Array.isArray(t)||!Array.isArray(f)||!Array.isArray(a))throw new Error(`Generator returned invalid array for length ${r}`);let m=process.hrtime();t.sort(k);let l=process.hrtime(),d=m[0]*1e9+m[1],p=l[0]*1e9+l[1];o+=p-d;let h=process.hrtime();w(f,k);let b=process.hrtime(),L=h[0]*1e9+h[1],O=b[0]*1e9+b[1];s+=O-L;let A=process.hrtime();$(a,k);let E=process.hrtime(),F=A[0]*1e9+A[1],U=E[0]*1e9+E[1];c+=U-F}return{defaultTime:o/n,timsortTime:s/n,oldTimsortTime:c/n}}getDefaultResults(){return this.defaultResults}getTimsortResults(){return this.timsortResults}getOldTimsortResults(){return this.oldTimsortResults}};console.log("Starting benchmark...");var y=new I;y.runBenchmark();console.log("Benchmark completed.");
