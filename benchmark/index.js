import U from"cli-table3";var A=class{static randomInt(n){let t=[];for(let m=0;m<n;m++)t.push(Math.floor(Math.random()*9007199254740992));return t}static descendingInt(n){let t=[];for(let m=0;m<n;m++)t.push(n-m);return t}static ascendingInt(n){let t=[];for(let m=0;m<n;m++)t.push(m);return t}static ascending3RandomExchangesInt(n){let t=[];for(let m=0;m<n;m++)t.push(m);for(let m=0;m<1;m++){let r=Math.floor(Math.random()*n),f=Math.floor(Math.random()*n),s=t[r];t[r]=t[f],t[f]=s}return t}static ascending10RandomEndInt(n){let t=[];for(let r=0;r<n;r++)t.push(r);let m=Math.max(0,n-10);for(let r=m;r<n;r++)t[r]=Math.floor(Math.random()*n);return t}static allEqualInt(n){let t=[];for(let m=0;m<n;m++)t.push(42);return t}static manyDuplicateInt(n){let t=[];for(let m=0;m<n;m++)t.push(Math.floor(Math.random()*(n/2*(Math.log(n)/Math.LN10))));return t}static someDuplicateInt(n){let t=[];for(let m=0;m<n;m++)t.push(Math.floor(Math.random()*n));return t}};var k=new Float32Array([1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9]),I=class{array;compare;minGallop=7;tmp;constructor(n,t,m){this.array=n,this.compare=m,this.tmp=new Array(t<2*256?t>>>1:256)}mergeAt(n,t,m,r){let f=this.compare,s=this.array,i=r[n],e=m[n],o=r[n+1],c=m[n+1];m[n]=e+c,n===t-3&&(r[n+1]=r[n+2],m[n+1]=m[n+2]),t--;let u=w(s[o],s,i,e,0,f);i+=u,e-=u,e!==0&&(c=_(s[i+e-1],s,o,c,c-1,f),c!==0&&(e<=c?this.mergeLow(i,e,o,c):this.mergeHigh(i,e,o,c)))}mergeHigh(n,t,m,r){let f=this.compare,s=this.array,i=this.tmp,e=0;for(e;e<r;e++)i[e]=s[m+e];let o=n+t-1,c=r-1,u=m+r-1,T=0,b=0;if(s[u--]=s[o--],--t===0){for(T=u-(r-1),e=0;e<r;e++)s[T+e]=i[e];return}if(r===1){for(u-=t,o-=t,b=u+1,T=o+1,e=t-1;e>=0;e--)s[b+e]=s[T+e];s[u]=i[c];return}let p=this.minGallop;for(;;){let l=0,d=0,h=!1;do if(f(i[c],s[o])<0){if(s[u--]=s[o--],l++,d=0,--t===0){h=!0;break}}else if(s[u--]=i[c--],d++,l=0,--r===1){h=!0;break}while((l|d)<p);if(h)break;do{if(l=t-w(i[c],s,n,t,t-1,f),l!==0){for(u-=l,o-=l,t-=l,b=u+1,T=o+1,e=l-1;e>=0;e--)s[b+e]=s[T+e];if(t===0){h=!0;break}}if(s[u--]=i[c--],--r===1){h=!0;break}if(d=r-_(s[o],i,0,r,r-1,f),d!==0){for(u-=d,c-=d,r-=d,b=u+1,T=c+1,e=0;e<d;e++)s[b+e]=i[T+e];if(r<=1){h=!0;break}}if(s[u--]=s[o--],--t===0){h=!0;break}p--}while(l>=7||d>=7);if(h)break;p<0&&(p=0),p+=2}if(this.minGallop=p,p<1&&(this.minGallop=1),r===1){for(u-=t,o-=t,b=u+1,T=o+1,e=t-1;e>=0;e--)s[b+e]=s[T+e];s[u]=i[c]}else{if(r===0)throw new Error("mergeHigh preconditions were not respected");for(T=u-(r-1),e=0;e<r;e++)s[T+e]=i[e]}}mergeLow(n,t,m,r){let f=this.compare,s=this.array,i=this.tmp,e=0;for(;e<t;e++)i[e]=s[n+e];let o=0,c=m,u=n;if(s[u++]=s[c++],--r===0){for(e=0;e<t;e++)s[u+e]=i[o+e];return}if(t===1){for(e=0;e<r;e++)s[u+e]=s[c+e];s[u+r]=i[o];return}let T=this.minGallop;for(;;){let b=0,p=0,l=!1;do if(f(s[c],i[o])<0){if(s[u++]=s[c++],p++,b=0,--r===0){l=!0;break}}else if(s[u++]=i[o++],b++,p=0,--t===1){l=!0;break}while((b|p)<T);if(l)break;do{if(b=w(s[c],i,o,t,0,f),b!==0){for(e=0;e<b;e++)s[u+e]=i[o+e];if(u+=b,o+=b,t-=b,t<=1){l=!0;break}}if(s[u++]=s[c++],--r===0){l=!0;break}if(p=_(i[o],s,c,r,0,f),p!==0){for(e=0;e<p;e++)s[u+e]=s[c+e];if(u+=p,c+=p,r-=p,r===0){l=!0;break}}if(s[u++]=i[o++],--t===1){l=!0;break}T--}while(b>=7||p>=7);if(l)break;T<0&&(T=0),T+=2}if(this.minGallop=T,T<1&&(this.minGallop=1),t===1){for(e=0;e<r;e++)s[u+e]=s[c+e];s[u+r]=i[o]}else{if(t===0)throw new Error("mergeLow preconditions were not respected");for(e=0;e<t;e++)s[u+e]=i[o+e]}}};function E(a,n,t=0,m=a.length){n?typeof n!="function"&&(m=t,t=n,n=D):n=D;let r=m-t;if(r<2)return a;let f=0;if(r<32)return f=g(a,t,m,n),y(a,t,m,t+f,n),a;let s=a.length,i=new I(a,s,n),e=0,o=s<120?5:s<1542?10:s<119151?19:40,c=new Array(o),u=new Array(o),T=0,b=r;for(;b>=32;)T|=b&1,b>>=1;let p=T+b;do{if(f=g(a,t,m,n),f<p){let l=r;l>p&&(l=p),y(a,t,t+l,t+f,n),f=l}for(c[e]=t,u[e]=f,e+=1;e>1;){let l=e-2;if(l>=1&&u[l-1]<=u[l]+u[l+1]||l>=2&&u[l-2]<=u[l]+u[l-1])u[l-1]<u[l+1]&&l--;else if(u[l]>u[l+1])break;i.mergeAt(l,e--,u,c)}r-=f,t+=f}while(r!==0);for(;e>1;){let l=e-2;l>0&&u[l-1]<u[l+1]&&l--,i.mergeAt(l,e--,u,c)}return a}function D(a,n){if(a===n)return 0;if(~~a===a&&~~n===n){if(a===0||n===0)return a-n;if(a<0||n<0){if(n>=0)return-1;if(a>=0)return 1;a=-a,n=-n}let r=Math.log10(a)|0,f=Math.log10(n)|0,s=0;return r<f?(a*=k[f-r-1],n/=10,s=-1):r>f&&(n*=k[r-f-1],a/=10,s=1),a===n?s:a-n}let t=`${a}`,m=`${n}`;return t===m?0:t<m?-1:1}function y(a,n,t,m,r){m===n&&m++;let f;for(;m<t;m++){let s=a[m],i=n,e=m;for(;i<e;)f=i+e>>>1,r(s,a[f])<0?e=f:i=f+1;let o=m-i;switch(o){case 3:a[i+3]=a[i+2];case 2:a[i+2]=a[i+1];case 1:a[i+1]=a[i];break;default:for(;o>0;)a[i+o]=a[i+o-1],o--}a[i]=s}}function _(a,n,t,m,r,f){let s=t+r,i=0,e=0,o=1,c;if(f(a,n[s])>0){for(e=m-r;o<e&&f(a,n[s+o])>0;)i=o,o=(o<<1)+1,o<=0&&(o=e);o>e&&(o=e),i+=r,o+=r}else{for(e=r+1;o<e&&f(a,n[s-o])<=0;)i=o,o=(o<<1)+1,o<=0&&(o=e);o>e&&(o=e),c=i,i=r-o,o=r-c}for(i++;i<o;)c=i+(o-i>>>1),f(a,n[t+c])>0?i=c+1:o=c;return o}function w(a,n,t,m,r,f){let s=t+r,i=0,e=0,o=1,c;if(f(a,n[s])<0){for(e=r+1;o<e&&f(a,n[s-o])<0;)i=o,o=(o<<1)+1,o<=0&&(o=e);o>e&&(o=e),c=i,i=r-o,o=r-c}else{for(e=m-r;o<e&&f(a,n[s+o])>=0;)i=o,o=(o<<1)+1,o<=0&&(o=e);o>e&&(o=e),i+=r,o+=r}for(i++;i<o;)c=i+(o-i>>>1),f(a,n[t+c])<0?o=c:i=c+1;return o}function g(a,n,t,m){let r=n+1;if(r===t)return 1;if(m(a[r++],a[n])<0){for(;r<t&&m(a[r],a[r-1])<0;)r++;for(r--;n<r;){let f=a[n];a[n++]=a[r],a[r--]=f}r++}else for(;r<t&&m(a[r],a[r-1])>=0;)r++;return r-n}import x from"timsort";var M=(a,n)=>a-n,S=[10,100,1e3,1e4],C=a=>Math.floor(12e6/(a*(Math.log(a)/Math.LN10))),L=class{table;constructor(){this.table=new U({head:["ArrayType","Length","Time default","Time old","Time new","Speedup default","Speedup old"],colWidths:[30,20,10,15,20],style:{head:["cyan"]}})}runBenchmark(){let n=[{name:"randomInt",fn:A.randomInt},{name:"descendingInt",fn:A.descendingInt},{name:"ascendingInt",fn:A.ascendingInt},{name:"ascending3RandomExchangesInt",fn:A.ascending3RandomExchangesInt},{name:"ascending10RandomEndInt",fn:A.ascending10RandomEndInt},{name:"allEqualInt",fn:A.allEqualInt},{name:"manyDuplicateInt",fn:A.manyDuplicateInt},{name:"someDuplicateInt",fn:A.someDuplicateInt}];if(n.length===0){console.log("No generator methods available to process.");return}for(let{name:t,fn:m}of n)for(let r of S){console.log(`Benchmarking ${t} with length ${r}`);try{let{defaultTime:f,timsortTime:s,oldTimsortTime:i}=this.benchmarkGenerator(m,r);this.table.push([t,r.toString(),Math.floor(f).toString(),Math.floor(i).toString(),Math.floor(s).toString(),s!==0?(f/s).toFixed(2):"N/A",s!==0?(i/s).toFixed(2):"N/A"])}catch(f){console.error(`Error benchmarking ${t} with length ${r}:`,f)}}console.log(this.table.toString())}benchmarkGenerator(n,t){let m=0,r=0,f=0,s=C(t);console.log(`Running ${s} repetitions for length ${t}`);for(let i=0;i<s;i++){let e=n(t),o=e.slice(),c=e.slice();if(!Array.isArray(e)||!Array.isArray(o)||!Array.isArray(c))throw new Error(`Generator returned invalid array for length ${t}`);let u=process.hrtime();e.sort(M);let T=process.hrtime(),b=u[0]*1e9+u[1],p=T[0]*1e9+T[1];m+=p-b;let l=process.hrtime();x(c,M);let d=process.hrtime(),h=l[0]*1e9+l[1],O=d[0]*1e9+d[1];f+=O-h;let G=process.hrtime();E(o,M);let N=process.hrtime(),F=G[0]*1e9+G[1],R=N[0]*1e9+N[1];r+=R-F}return{defaultTime:m/s,timsortTime:r/s,oldTimsortTime:f/s}}};console.log("Starting benchmark...");var P=new L;P.runBenchmark();console.log("Benchmark completed.");
