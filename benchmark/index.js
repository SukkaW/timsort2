import x from"cli-table3";var h=class{static randomInt(n){let t=[];for(let i=0;i<n;i++)t.push(Math.floor(Math.random()*9007199254740992));return t}static descendingInt(n){let t=[];for(let i=0;i<n;i++)t.push(n-i);return t}static ascendingInt(n){let t=[];for(let i=0;i<n;i++)t.push(i);return t}static ascending3RandomExchangesInt(n){let t=[];for(let i=0;i<n;i++)t.push(i);for(let i=0;i<1;i++){let o=Math.floor(Math.random()*n),c=Math.floor(Math.random()*n),r=t[o];t[o]=t[c],t[c]=r}return t}static ascending10RandomEndInt(n){let t=[];for(let o=0;o<n;o++)t.push(o);let i=Math.max(0,n-10);for(let o=i;o<n;o++)t[o]=Math.floor(Math.random()*n);return t}static allEqualInt(n){let t=[];for(let i=0;i<n;i++)t.push(42);return t}static manyDuplicateInt(n){let t=[];for(let i=0;i<n;i++)t.push(Math.floor(Math.random()*(n/2*(Math.log(n)/Math.LN10))));return t}static someDuplicateInt(n){let t=[];for(let i=0;i<n;i++)t.push(Math.floor(Math.random()*n));return t}};var k=new Float32Array([1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9]),_=class{array;compare;length;minGallop=7;runLength;runStart;stackLength;tmpStorageLength=256;tmp;constructor(n,t){this.array=n,this.compare=t;let i=this.length=n.length;i<2*256&&(this.tmpStorageLength=i>>>1),this.tmp=new Array(this.tmpStorageLength),this.stackLength=i<120?5:i<1542?10:i<119151?19:40,this.runStart=new Array(this.stackLength),this.runLength=new Array(this.stackLength)}mergeAt(n,t){let i=this.compare,o=this.array,c=this.runLength,r=this.runStart,m=r[n],e=c[n],s=r[n+1],f=c[n+1];this.runLength[n]=e+f,n===t-3&&(r[n+1]=r[n+2],c[n+1]=c[n+2]),t--;let a=g(o[s],o,m,e,0,i);m+=a,e-=a,e!==0&&(f=L(o[m+e-1],o,s,f,f-1,i),f!==0&&(e<=f?this.mergeLow(m,e,s,f):this.mergeHigh(m,e,s,f)))}mergeHigh(n,t,i,o){let c=this.compare,r=this.array,m=this.tmp,e=0;for(e;e<o;e++)m[e]=r[i+e];let s=n+t-1,f=o-1,a=i+o-1,l=0,p=0;if(r[a--]=r[s--],--t===0){for(l=a-(o-1),e=0;e<o;e++)r[l+e]=m[e];return}if(o===1){for(a-=t,s-=t,p=a+1,l=s+1,e=t-1;e>=0;e--)r[p+e]=r[l+e];r[a]=m[f];return}let d=this.minGallop;for(;;){let b=0,T=0,A=!1;do if(c(m[f],r[s])<0){if(r[a--]=r[s--],b++,T=0,--t===0){A=!0;break}}else if(r[a--]=m[f--],T++,b=0,--o===1){A=!0;break}while((b|T)<d);if(A)break;do{if(b=t-g(m[f],r,n,t,t-1,c),b!==0){for(a-=b,s-=b,t-=b,p=a+1,l=s+1,e=b-1;e>=0;e--)r[p+e]=r[l+e];if(t===0){A=!0;break}}if(r[a--]=m[f--],--o===1){A=!0;break}if(T=o-L(r[s],m,0,o,o-1,c),T!==0){for(a-=T,f-=T,o-=T,p=a+1,l=f+1,e=0;e<T;e++)r[p+e]=m[l+e];if(o<=1){A=!0;break}}if(r[a--]=r[s--],--t===0){A=!0;break}d--}while(b>=7||T>=7);if(A)break;d<0&&(d=0),d+=2}if(this.minGallop=d,d<1&&(this.minGallop=1),o===1){for(a-=t,s-=t,p=a+1,l=s+1,e=t-1;e>=0;e--)r[p+e]=r[l+e];r[a]=m[f]}else{if(o===0)throw new Error("mergeHigh preconditions were not respected");for(l=a-(o-1),e=0;e<o;e++)r[l+e]=m[e]}}mergeLow(n,t,i,o){let c=this.compare,r=this.array,m=this.tmp,e=0;for(;e<t;e++)m[e]=r[n+e];let s=0,f=i,a=n;if(r[a++]=r[f++],--o===0){for(e=0;e<t;e++)r[a+e]=m[s+e];return}if(t===1){for(e=0;e<o;e++)r[a+e]=r[f+e];r[a+o]=m[s];return}let l=this.minGallop;for(;;){let p=0,d=0,b=!1;do if(c(r[f],m[s])<0){if(r[a++]=r[f++],d++,p=0,--o===0){b=!0;break}}else if(r[a++]=m[s++],p++,d=0,--t===1){b=!0;break}while((p|d)<l);if(b)break;do{if(p=g(r[f],m,s,t,0,c),p!==0){for(e=0;e<p;e++)r[a+e]=m[s+e];if(a+=p,s+=p,t-=p,t<=1){b=!0;break}}if(r[a++]=r[f++],--o===0){b=!0;break}if(d=L(m[s],r,f,o,0,c),d!==0){for(e=0;e<d;e++)r[a+e]=r[f+e];if(a+=d,f+=d,o-=d,o===0){b=!0;break}}if(r[a++]=m[s++],--t===1){b=!0;break}l--}while(p>=7||d>=7);if(b)break;l<0&&(l=0),l+=2}if(this.minGallop=l,l<1&&(this.minGallop=1),t===1){for(e=0;e<o;e++)r[a+e]=r[f+e];r[a+o]=m[s]}else{if(t===0)throw new Error("mergeLow preconditions were not respected");for(e=0;e<t;e++)r[a+e]=m[s+e]}}};function w(u,n,t=0,i=u.length){n?typeof n!="function"&&(i=t,t=n,n=N):n=N;let o=i-t;if(o<2)return u;let c=0;if(o<32)return c=D(u,t,i,n),R(u,t,i,t+c,n),u;let r=new _(u,n),m=0,e=y(o),s=r.runLength;do{if(c=D(u,t,i,n),c<e){let f=o;f>e&&(f=e),R(u,t,t+f,t+c,n),c=f}for(r.runStart[m]=t,s[m]=c,m+=1;m>1;){let f=m-2;if(f>=1&&s[f-1]<=s[f]+s[f+1]||f>=2&&s[f-2]<=s[f]+s[f-1])s[f-1]<s[f+1]&&f--;else if(s[f]>s[f+1])break;r.mergeAt(f,m--)}o-=c,t+=c}while(o!==0);for(;m>1;){let f=m-2;f>0&&s[f-1]<s[f+1]&&f--,r.mergeAt(f,m--)}return u}function N(u,n){if(u===n)return 0;if(~~u===u&&~~n===n){if(u===0||n===0)return u-n;if(u<0||n<0){if(n>=0)return-1;if(u>=0)return 1;u=-u,n=-n}let o=Math.log10(u)|0,c=Math.log10(n)|0,r=0;return o<c?(u*=k[c-o-1],n/=10,r=-1):o>c&&(n*=k[o-c-1],u/=10,r=1),u===n?r:u-n}let t=`${u}`,i=`${n}`;return t===i?0:t<i?-1:1}function R(u,n,t,i,o){for(i===n&&i++;i<t;i++){let c=u[i],r=n,m=i;for(;r<m;){let s=r+m>>>1;o(c,u[s])<0?m=s:r=s+1}let e=i-r;switch(e){case 3:u[r+3]=u[r+2];case 2:u[r+2]=u[r+1];case 1:u[r+1]=u[r];break;default:for(;e>0;)u[r+e]=u[r+e-1],e--}u[r]=c}}function L(u,n,t,i,o,c){let r=t+o,m=0,e=0,s=1,f;if(c(u,n[r])>0){for(e=i-o;s<e&&c(u,n[r+s])>0;)m=s,s=(s<<1)+1,s<=0&&(s=e);s>e&&(s=e),m+=o,s+=o}else{for(e=o+1;s<e&&c(u,n[r-s])<=0;)m=s,s=(s<<1)+1,s<=0&&(s=e);s>e&&(s=e),f=m,m=o-s,s=o-f}for(m++;m<s;)f=m+(s-m>>>1),c(u,n[t+f])>0?m=f+1:s=f;return s}function g(u,n,t,i,o,c){let r=0,m=0,e=1;if(c(u,n[t+o])<0){for(m=o+1;e<m&&c(u,n[t+o-e])<0;)r=e,e=(e<<1)+1,e<=0&&(e=m);e>m&&(e=m);let s=r;r=o-e,e=o-s}else{for(m=i-o;e<m&&c(u,n[t+o+e])>=0;)r=e,e=(e<<1)+1,e<=0&&(e=m);e>m&&(e=m),r+=o,e+=o}for(r++;r<e;){let s=r+(e-r>>>1);c(u,n[t+s])<0?e=s:r=s+1}return e}function D(u,n,t,i){let o=n+1;if(o===t)return 1;if(i(u[o++],u[n])<0){for(;o<t&&i(u[o],u[o-1])<0;)o++;U(u,n,o)}else for(;o<t&&i(u[o],u[o-1])>=0;)o++;return o-n}function y(u){let n=0;for(;u>=32;)n|=u&1,u>>=1;return u+n}function U(u,n,t){for(t--;n<t;){let i=u[n];u[n++]=u[t],u[t--]=i}}import P from"timsort";var I=(u,n)=>u-n,$=[10,100,1e3,1e4],H=u=>Math.floor(12e6/(u*(Math.log(u)/Math.LN10))),E=class{table;constructor(){this.table=new x({head:["ArrayType","Length","Time default","Time old","Time new","Speedup default","Speedup old"],colWidths:[30,20,10,15,20],style:{head:["cyan"]}})}runBenchmark(){let n=[{name:"randomInt",fn:h.randomInt},{name:"descendingInt",fn:h.descendingInt},{name:"ascendingInt",fn:h.ascendingInt},{name:"ascending3RandomExchangesInt",fn:h.ascending3RandomExchangesInt},{name:"ascending10RandomEndInt",fn:h.ascending10RandomEndInt},{name:"allEqualInt",fn:h.allEqualInt},{name:"manyDuplicateInt",fn:h.manyDuplicateInt},{name:"someDuplicateInt",fn:h.someDuplicateInt}];if(n.length===0){console.log("No generator methods available to process.");return}for(let{name:t,fn:i}of n)for(let o of $){console.log(`Benchmarking ${t} with length ${o}`);try{let{defaultTime:c,timsortTime:r,oldTimsortTime:m}=this.benchmarkGenerator(i,o);this.table.push([t,o.toString(),Math.floor(c).toString(),Math.floor(m).toString(),Math.floor(r).toString(),r!==0?(c/r).toFixed(2):"N/A",r!==0?(m/r).toFixed(2):"N/A"])}catch(c){console.error(`Error benchmarking ${t} with length ${o}:`,c)}}console.log(this.table.toString())}benchmarkGenerator(n,t){let i=0,o=0,c=0,r=H(t);console.log(`Running ${r} repetitions for length ${t}`);for(let m=0;m<r;m++){let e=n(t),s=e.slice(),f=e.slice();if(!Array.isArray(e)||!Array.isArray(s)||!Array.isArray(f))throw new Error(`Generator returned invalid array for length ${t}`);let a=process.hrtime();e.sort(I);let l=process.hrtime(),p=a[0]*1e9+a[1],d=l[0]*1e9+l[1];i+=d-p;let b=process.hrtime();w(s,I);let T=process.hrtime(),A=b[0]*1e9+b[1],S=T[0]*1e9+T[1];o+=S-A;let M=process.hrtime();P(f,I);let G=process.hrtime(),O=M[0]*1e9+M[1],F=G[0]*1e9+G[1];c+=F-O}return{defaultTime:i/r,timsortTime:o/r,oldTimsortTime:c/r}}getDefaultResults(){return this.defaultResults}getTimsortResults(){return this.timsortResults}getOldTimsortResults(){return this.oldTimsortResults}};console.log("Starting benchmark...");var C=new E;C.runBenchmark();console.log("Benchmark completed.");
