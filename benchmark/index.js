import x from"cli-table3";var A=class{static randomInt(n){let r=[];for(let m=0;m<n;m++)r.push(Math.floor(Math.random()*9007199254740992));return r}static descendingInt(n){let r=[];for(let m=0;m<n;m++)r.push(n-m);return r}static ascendingInt(n){let r=[];for(let m=0;m<n;m++)r.push(m);return r}static ascending3RandomExchangesInt(n){let r=[];for(let m=0;m<n;m++)r.push(m);for(let m=0;m<1;m++){let t=Math.floor(Math.random()*n),u=Math.floor(Math.random()*n),o=r[t];r[t]=r[u],r[u]=o}return r}static ascending10RandomEndInt(n){let r=[];for(let t=0;t<n;t++)r.push(t);let m=Math.max(0,n-10);for(let t=m;t<n;t++)r[t]=Math.floor(Math.random()*n);return r}static allEqualInt(n){let r=[];for(let m=0;m<n;m++)r.push(42);return r}static manyDuplicateInt(n){let r=[];for(let m=0;m<n;m++)r.push(Math.floor(Math.random()*(n/2*(Math.log(n)/Math.LN10))));return r}static someDuplicateInt(n){let r=[];for(let m=0;m<n;m++)r.push(Math.floor(Math.random()*n));return r}};var k=new Float32Array([1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9]),I=class{array;compare;minGallop=7;tmp;constructor(n,r,m){this.array=n,this.compare=m,this.tmp=new Array(r<2*256?r>>1:256)}mergeAt(n,r,m,t){let u=this.compare,o=this.array,i=t[n],e=m[n],s=t[n+1],f=m[n+1];m[n]=e+f,n===r-3&&(t[n+1]=t[n+2],m[n+1]=m[n+2]);let c=w(o[s],o,i,e,0,u);i+=c,e-=c,e!==0&&(f=_(o[i+e-1],o,s,f,f-1,u),f!==0&&(e<=f?this.mergeLow(i,e,s,f):this.mergeHigh(i,e,s,f)))}mergeHigh(n,r,m,t){let u=this.compare,o=this.array,i=this.tmp,e=0;for(e;e<t;e++)i[e]=o[m+e];let s=n+r-1,f=t-1,c=m+t-1,T=0,b=0;if(o[c--]=o[s--],--r===0){for(T=c-(t-1),e=0;e<t;e++)o[T+e]=i[e];return}if(t===1){for(c-=r,s-=r,b=c+1,T=s+1,e=r-1;e>=0;e--)o[b+e]=o[T+e];o[c]=i[f];return}let p=this.minGallop;for(;;){let l=0,d=0,h=!1;do if(u(i[f],o[s])<0){if(o[c--]=o[s--],l++,d=0,--r===0){h=!0;break}}else if(o[c--]=i[f--],d++,l=0,--t===1){h=!0;break}while((l|d)<p);if(h)break;do{if(l=r-w(i[f],o,n,r,r-1,u),l!==0){for(c-=l,s-=l,r-=l,b=c+1,T=s+1,e=l-1;e>=0;e--)o[b+e]=o[T+e];if(r===0){h=!0;break}}if(o[c--]=i[f--],--t===1){h=!0;break}if(d=t-_(o[s],i,0,t,t-1,u),d!==0){for(c-=d,f-=d,t-=d,b=c+1,T=f+1,e=0;e<d;e++)o[b+e]=i[T+e];if(t<=1){h=!0;break}}if(o[c--]=o[s--],--r===0){h=!0;break}p--}while(l>=7||d>=7);if(h)break;p<0&&(p=0),p+=2}if(this.minGallop=p,p<1&&(this.minGallop=1),t===1){for(c-=r,s-=r,b=c+1,T=s+1,e=r-1;e>=0;e--)o[b+e]=o[T+e];o[c]=i[f]}else{if(t===0)throw new Error("mergeHigh preconditions were not respected");for(T=c-(t-1),e=0;e<t;e++)o[T+e]=i[e]}}mergeLow(n,r,m,t){let u=this.compare,o=this.array,i=this.tmp,e=0;for(;e<r;e++)i[e]=o[n+e];let s=0,f=m,c=n;if(o[c++]=o[f++],--t===0){for(e=0;e<r;e++)o[c+e]=i[s+e];return}if(r===1){for(e=0;e<t;e++)o[c+e]=o[f+e];o[c+t]=i[s];return}let T=this.minGallop;for(;;){let b=0,p=0,l=!1;do if(u(o[f],i[s])<0){if(o[c++]=o[f++],p++,b=0,--t===0){l=!0;break}}else if(o[c++]=i[s++],b++,p=0,--r===1){l=!0;break}while((b|p)<T);if(l)break;do{if(b=w(o[f],i,s,r,0,u),b!==0){for(e=0;e<b;e++)o[c+e]=i[s+e];if(c+=b,s+=b,r-=b,r<=1){l=!0;break}}if(o[c++]=o[f++],--t===0){l=!0;break}if(p=_(i[s],o,f,t,0,u),p!==0){for(e=0;e<p;e++)o[c+e]=o[f+e];if(c+=p,f+=p,t-=p,t===0){l=!0;break}}if(o[c++]=i[s++],--r===1){l=!0;break}T--}while(b>=7||p>=7);if(l)break;T<0&&(T=0),T+=2}if(this.minGallop=T,T<1&&(this.minGallop=1),r===1){for(e=0;e<t;e++)o[c+e]=o[f+e];o[c+t]=i[s]}else{if(r===0)throw new Error("mergeLow preconditions were not respected");for(e=0;e<r;e++)o[c+e]=i[s+e]}}};function E(a,n=R,r=0,m=a.length){let t=m-r;if(t<2)return a;let u=0;if(t<32)return u=y(a,r,m,n),D(a,r,m,r+u,n),a;let o=a.length,i=new I(a,o,n),e=0,s=o<120?5:o<1542?10:o<119151?19:40,f=new Array(s),c=new Array(s),T=0,b=t;for(;b>=32;)T|=b&1,b>>=1;let p=T+b;do{if(u=y(a,r,m,n),u<p){let l=t;l>p&&(l=p),D(a,r,r+l,r+u,n),u=l}for(f[e]=r,c[e]=u,e+=1;e>1;){let l=e-2;if(l>=1&&c[l-1]<=c[l]+c[l+1]||l>=2&&c[l-2]<=c[l]+c[l-1])c[l-1]<c[l+1]&&l--;else if(c[l]>c[l+1])break;i.mergeAt(l,e--,c,f)}t-=u,r+=u}while(t!==0);for(;e>1;){let l=e-2;l>0&&c[l-1]<c[l+1]&&l--,i.mergeAt(l,e--,c,f)}return a}function R(a,n){if(a===n)return 0;if(~~a===a&&~~n===n){if(a===0||n===0)return a-n;if(a<0||n<0){if(n>=0)return-1;if(a>=0)return 1;a=-a,n=-n}let t=Math.log10(a)|0,u=Math.log10(n)|0,o=0;return t<u?(a*=k[u-t-1],n/=10,o=-1):t>u&&(n*=k[t-u-1],a/=10,o=1),a===n?o:a-n}let r=`${a}`,m=`${n}`;return r===m?0:r<m?-1:1}function D(a,n,r,m,t){m===n&&m++;let u;for(;m<r;m++){let o=a[m],i=n,e=m;for(;i<e;)u=i+e>>1,t(o,a[u])<0?e=u:i=u+1;switch(u=m-i,u){case 3:a[i+3]=a[i+2];case 2:a[i+2]=a[i+1];case 1:a[i+1]=a[i];break;default:for(;u>0;)a[i+u]=a[i+u-1],u--}a[i]=o}}function _(a,n,r,m,t,u){let o=r+t,i=0,e=0,s=1,f;if(u(a,n[o])>0){for(e=m-t;s<e&&u(a,n[o+s])>0;)i=s,s=(s<<1)+1;s>e&&(s=e),i+=t,s+=t}else{for(e=t+1;s<e&&u(a,n[o-s])<=0;)i=s,s=(s<<1)+1;s>e&&(s=e),f=i,i=t-s,s=t-f}for(i++;i<s;)f=i+(s-i>>>1),u(a,n[r+f])>0?i=f+1:s=f;return s}function w(a,n,r,m,t,u){let o=r+t,i=0,e=0,s=1,f;if(u(a,n[o])<0){for(e=t+1;s<e&&u(a,n[o-s])<0;)i=s,s=(s<<1)+1;s>e&&(s=e),f=i,i=t-s,s=t-f}else{for(e=m-t;s<e&&u(a,n[o+s])>=0;)i=s,s=(s<<1)+1;s>e&&(s=e),i+=t,s+=t}for(i++;i<s;)f=i+(s-i>>>1),u(a,n[r+f])<0?s=f:i=f+1;return s}function y(a,n,r,m){let t=n+1;if(t===r)return 1;if(m(a[t++],a[n])<0){for(;t<r&&m(a[t],a[t-1])<0;)t++;for(t--;n<t;){let u=a[n];a[n++]=a[t],a[t--]=u}t++}else for(;t<r&&m(a[t],a[t-1])>=0;)t++;return t-n}import S from"timsort";var M=(a,n)=>a-n,U=[10,100,1e3,1e4],C=a=>Math.floor(12e6/(a*(Math.log(a)/Math.LN10))),L=class{table;constructor(){this.table=new x({head:["ArrayType","Length","Time default","Time old","Time new","Speedup default","Speedup old"],colWidths:[30,20,10,15,20],style:{head:["cyan"]}})}runBenchmark(){let n=[{name:"randomInt",fn:A.randomInt},{name:"descendingInt",fn:A.descendingInt},{name:"ascendingInt",fn:A.ascendingInt},{name:"ascending3RandomExchangesInt",fn:A.ascending3RandomExchangesInt},{name:"ascending10RandomEndInt",fn:A.ascending10RandomEndInt},{name:"allEqualInt",fn:A.allEqualInt},{name:"manyDuplicateInt",fn:A.manyDuplicateInt},{name:"someDuplicateInt",fn:A.someDuplicateInt}];if(n.length===0){console.log("No generator methods available to process.");return}for(let{name:r,fn:m}of n)for(let t of U){console.log(`Benchmarking ${r} with length ${t}`);try{let{defaultTime:u,timsortTime:o,oldTimsortTime:i}=this.benchmarkGenerator(m,t);this.table.push([r,t.toString(),Math.floor(u).toString(),Math.floor(i).toString(),Math.floor(o).toString(),o!==0?(u/o).toFixed(2):"N/A",o!==0?(i/o).toFixed(2):"N/A"])}catch(u){console.error(`Error benchmarking ${r} with length ${t}:`,u)}}console.log(this.table.toString())}benchmarkGenerator(n,r){let m=0,t=0,u=0,o=C(r);console.log(`Running ${o} repetitions for length ${r}`);for(let i=0;i<o;i++){let e=n(r),s=e.slice(),f=e.slice();if(!Array.isArray(e)||!Array.isArray(s)||!Array.isArray(f))throw new Error(`Generator returned invalid array for length ${r}`);let c=process.hrtime();e.sort(M);let T=process.hrtime(),b=c[0]*1e9+c[1],p=T[0]*1e9+T[1];m+=p-b;let l=process.hrtime();S(f,M);let d=process.hrtime(),h=l[0]*1e9+l[1],g=d[0]*1e9+d[1];u+=g-h;let G=process.hrtime();E(s,M);let N=process.hrtime(),O=G[0]*1e9+G[1],F=N[0]*1e9+N[1];t+=F-O}return{defaultTime:m/o,timsortTime:t/o,oldTimsortTime:u/o}}};console.log("Starting benchmark...");var P=new L;P.runBenchmark();console.log("Benchmark completed.");
