import x from"cli-table3";var T=class{static randomInt(n){let r=[];for(let i=0;i<n;i++)r.push(Math.floor(Math.random()*9007199254740992));return r}static descendingInt(n){let r=[];for(let i=0;i<n;i++)r.push(n-i);return r}static ascendingInt(n){let r=[];for(let i=0;i<n;i++)r.push(i);return r}static ascending3RandomExchangesInt(n){let r=[];for(let i=0;i<n;i++)r.push(i);for(let i=0;i<1;i++){let o=Math.floor(Math.random()*n),c=Math.floor(Math.random()*n),t=r[o];r[o]=r[c],r[c]=t}return r}static ascending10RandomEndInt(n){let r=[];for(let o=0;o<n;o++)r.push(o);let i=Math.max(0,n-10);for(let o=i;o<n;o++)r[o]=Math.floor(Math.random()*n);return r}static allEqualInt(n){let r=[];for(let i=0;i<n;i++)r.push(42);return r}static manyDuplicateInt(n){let r=[];for(let i=0;i<n;i++)r.push(Math.floor(Math.random()*(n/2*(Math.log(n)/Math.LN10))));return r}static someDuplicateInt(n){let r=[];for(let i=0;i<n;i++)r.push(Math.floor(Math.random()*n));return r}};var G=new Float32Array([1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9]),_=class{array;compare;length;minGallop=7;runLength;runStart;stackLength;stackSize=0;tmpStorageLength=256;tmp;constructor(n,r){this.array=n,this.compare=r;let i=this.length=n.length;i<2*256&&(this.tmpStorageLength=i>>>1),this.tmp=new Array(this.tmpStorageLength),this.stackLength=i<120?5:i<1542?10:i<119151?19:40,this.runStart=new Array(this.stackLength),this.runLength=new Array(this.stackLength)}mergeAt(n){let r=this.compare,i=this.array,o=this.runLength,c=this.runStart,t=c[n],m=o[n],e=c[n+1],s=o[n+1];this.runLength[n]=m+s,n===this.stackSize-3&&(c[n+1]=c[n+2],o[n+1]=o[n+2]),this.stackSize--;let f=g(i[e],i,t,m,0,r);t+=f,m-=f,m!==0&&(s=L(i[t+m-1],i,e,s,s-1,r),s!==0&&(m<=s?this.mergeLow(t,m,e,s):this.mergeHigh(t,m,e,s)))}mergeHigh(n,r,i,o){let c=this.compare,t=this.array,m=this.tmp,e=0;for(e;e<o;e++)m[e]=t[i+e];let s=n+r-1,f=o-1,a=i+o-1,l=0,p=0;if(t[a--]=t[s--],--r===0){for(l=a-(o-1),e=0;e<o;e++)t[l+e]=m[e];return}if(o===1){for(a-=r,s-=r,p=a+1,l=s+1,e=r-1;e>=0;e--)t[p+e]=t[l+e];t[a]=m[f];return}let d=this.minGallop;for(;;){let b=0,h=0,A=!1;do if(c(m[f],t[s])<0){if(t[a--]=t[s--],b++,h=0,--r===0){A=!0;break}}else if(t[a--]=m[f--],h++,b=0,--o===1){A=!0;break}while((b|h)<d);if(A)break;do{if(b=r-g(m[f],t,n,r,r-1,c),b!==0){for(a-=b,s-=b,r-=b,p=a+1,l=s+1,e=b-1;e>=0;e--)t[p+e]=t[l+e];if(r===0){A=!0;break}}if(t[a--]=m[f--],--o===1){A=!0;break}if(h=o-L(t[s],m,0,o,o-1,c),h!==0){for(a-=h,f-=h,o-=h,p=a+1,l=f+1,e=0;e<h;e++)t[p+e]=m[l+e];if(o<=1){A=!0;break}}if(t[a--]=t[s--],--r===0){A=!0;break}d--}while(b>=7||h>=7);if(A)break;d<0&&(d=0),d+=2}if(this.minGallop=d,d<1&&(this.minGallop=1),o===1){for(a-=r,s-=r,p=a+1,l=s+1,e=r-1;e>=0;e--)t[p+e]=t[l+e];t[a]=m[f]}else{if(o===0)throw new Error("mergeHigh preconditions were not respected");for(l=a-(o-1),e=0;e<o;e++)t[l+e]=m[e]}}mergeLow(n,r,i,o){let c=this.compare,t=this.array,m=this.tmp,e=0;for(;e<r;e++)m[e]=t[n+e];let s=0,f=i,a=n;if(t[a++]=t[f++],--o===0){for(e=0;e<r;e++)t[a+e]=m[s+e];return}if(r===1){for(e=0;e<o;e++)t[a+e]=t[f+e];t[a+o]=m[s];return}let l=this.minGallop;for(;;){let p=0,d=0,b=!1;do if(c(t[f],m[s])<0){if(t[a++]=t[f++],d++,p=0,--o===0){b=!0;break}}else if(t[a++]=m[s++],p++,d=0,--r===1){b=!0;break}while((p|d)<l);if(b)break;do{if(p=g(t[f],m,s,r,0,c),p!==0){for(e=0;e<p;e++)t[a+e]=m[s+e];if(a+=p,s+=p,r-=p,r<=1){b=!0;break}}if(t[a++]=t[f++],--o===0){b=!0;break}if(d=L(m[s],t,f,o,0,c),d!==0){for(e=0;e<d;e++)t[a+e]=t[f+e];if(a+=d,f+=d,o-=d,o===0){b=!0;break}}if(t[a++]=m[s++],--r===1){b=!0;break}l--}while(p>=7||d>=7);if(b)break;l<0&&(l=0),l+=2}if(this.minGallop=l,l<1&&(this.minGallop=1),r===1){for(e=0;e<o;e++)t[a+e]=t[f+e];t[a+o]=m[s]}else{if(r===0)throw new Error("mergeLow preconditions were not respected");for(e=0;e<r;e++)t[a+e]=m[s+e]}}};function w(u,n,r=0,i=u.length){n?typeof n!="function"&&(i=r,r=n,n=S):n=S;let o=i-r;if(o<2)return u;let c=0;if(o<32)return c=R(u,r,i,n),N(u,r,i,r+c,n),u;let t=new _(u,n),m=y(o),e=t.runLength;do{if(c=R(u,r,i,n),c<m){let s=o;s>m&&(s=m),N(u,r,r+s,r+c,n),c=s}for(t.runStart[t.stackSize]=r,e[t.stackSize]=c,t.stackSize+=1;t.stackSize>1;){let s=t.stackSize-2;if(s>=1&&e[s-1]<=e[s]+e[s+1]||s>=2&&e[s-2]<=e[s]+e[s-1])e[s-1]<e[s+1]&&s--;else if(e[s]>e[s+1])break;t.mergeAt(s)}o-=c,r+=c}while(o!==0);for(;t.stackSize>1;){let s=t.stackSize-2;s>0&&t.runLength[s-1]<t.runLength[s+1]&&s--,t.mergeAt(s)}return u}function S(u,n){if(u===n)return 0;if(~~u===u&&~~n===n){if(u===0||n===0)return u-n;if(u<0||n<0){if(n>=0)return-1;if(u>=0)return 1;u=-u,n=-n}let o=Math.log10(u)|0,c=Math.log10(n)|0,t=0;return o<c?(u*=G[c-o-1],n/=10,t=-1):o>c&&(n*=G[o-c-1],u/=10,t=1),u===n?t:u-n}let r=`${u}`,i=`${n}`;return r===i?0:r<i?-1:1}function N(u,n,r,i,o){for(i===n&&i++;i<r;i++){let c=u[i],t=n,m=i;for(;t<m;){let s=t+m>>>1;o(c,u[s])<0?m=s:t=s+1}let e=i-t;switch(e){case 3:u[t+3]=u[t+2];case 2:u[t+2]=u[t+1];case 1:u[t+1]=u[t];break;default:for(;e>0;)u[t+e]=u[t+e-1],e--}u[t]=c}}function L(u,n,r,i,o,c){let t=r+o,m=0,e=0,s=1,f;if(c(u,n[t])>0){for(e=i-o;s<e&&c(u,n[t+s])>0;)m=s,s=(s<<1)+1,s<=0&&(s=e);s>e&&(s=e),m+=o,s+=o}else{for(e=o+1;s<e&&c(u,n[t-s])<=0;)m=s,s=(s<<1)+1,s<=0&&(s=e);s>e&&(s=e),f=m,m=o-s,s=o-f}for(m++;m<s;)f=m+(s-m>>>1),c(u,n[r+f])>0?m=f+1:s=f;return s}function g(u,n,r,i,o,c){let t=0,m=0,e=1;if(c(u,n[r+o])<0){for(m=o+1;e<m&&c(u,n[r+o-e])<0;)t=e,e=(e<<1)+1,e<=0&&(e=m);e>m&&(e=m);let s=t;t=o-e,e=o-s}else{for(m=i-o;e<m&&c(u,n[r+o+e])>=0;)t=e,e=(e<<1)+1,e<=0&&(e=m);e>m&&(e=m),t+=o,e+=o}for(t++;t<e;){let s=t+(e-t>>>1);c(u,n[r+s])<0?e=s:t=s+1}return e}function R(u,n,r,i){let o=n+1;if(o===r)return 1;if(i(u[o++],u[n])<0){for(;o<r&&i(u[o],u[o-1])<0;)o++;U(u,n,o)}else for(;o<r&&i(u[o],u[o-1])>=0;)o++;return o-n}function y(u){let n=0;for(;u>=32;)n|=u&1,u>>=1;return u+n}function U(u,n,r){for(r--;n<r;){let i=u[n];u[n++]=u[r],u[r--]=i}}import z from"timsort";var k=(u,n)=>u-n,P=[10,100,1e3,1e4],$=u=>Math.floor(12e6/(u*(Math.log(u)/Math.LN10))),I=class{table;constructor(){this.table=new x({head:["ArrayType","Length","Time default","Time old","Time new","Speedup default","Speedup old"],colWidths:[30,20,10,15,20],style:{head:["cyan"]}})}runBenchmark(){let n=[{name:"randomInt",fn:T.randomInt},{name:"descendingInt",fn:T.descendingInt},{name:"ascendingInt",fn:T.ascendingInt},{name:"ascending3RandomExchangesInt",fn:T.ascending3RandomExchangesInt},{name:"ascending10RandomEndInt",fn:T.ascending10RandomEndInt},{name:"allEqualInt",fn:T.allEqualInt},{name:"manyDuplicateInt",fn:T.manyDuplicateInt},{name:"someDuplicateInt",fn:T.someDuplicateInt}];if(n.length===0){console.log("No generator methods available to process.");return}for(let{name:r,fn:i}of n)for(let o of P){console.log(`Benchmarking ${r} with length ${o}`);try{let{defaultTime:c,timsortTime:t,oldTimsortTime:m}=this.benchmarkGenerator(i,o);this.table.push([r,o.toString(),Math.floor(c).toString(),Math.floor(m).toString(),Math.floor(t).toString(),t!==0?(c/t).toFixed(2):"N/A",t!==0?(m/t).toFixed(2):"N/A"])}catch(c){console.error(`Error benchmarking ${r} with length ${o}:`,c)}}console.log(this.table.toString())}benchmarkGenerator(n,r){let i=0,o=0,c=0,t=$(r);console.log(`Running ${t} repetitions for length ${r}`);for(let m=0;m<t;m++){let e=n(r),s=e.slice(),f=e.slice();if(!Array.isArray(e)||!Array.isArray(s)||!Array.isArray(f))throw new Error(`Generator returned invalid array for length ${r}`);let a=process.hrtime();e.sort(k);let l=process.hrtime(),p=a[0]*1e9+a[1],d=l[0]*1e9+l[1];i+=d-p;let b=process.hrtime();w(s,k);let h=process.hrtime(),A=b[0]*1e9+b[1],D=h[0]*1e9+h[1];o+=D-A;let E=process.hrtime();z(f,k);let M=process.hrtime(),O=E[0]*1e9+E[1],F=M[0]*1e9+M[1];c+=F-O}return{defaultTime:i/t,timsortTime:o/t,oldTimsortTime:c/t}}getDefaultResults(){return this.defaultResults}getTimsortResults(){return this.timsortResults}getOldTimsortResults(){return this.oldTimsortResults}};console.log("Starting benchmark...");var H=new I;H.runBenchmark();console.log("Benchmark completed.");
